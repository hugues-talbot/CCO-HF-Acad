\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{a4wide}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}

\title{Distance and curvature}
\author{Hugues Talbot}

\begin{document}
\maketitle
	
	
	\section{Normals and curvature}
	
	There is a deep link between the evolution of the normal along a curve and the curvature.
	
	Let $C$ be a planar curve. To define the curvature at a point, we can consider
	the case of a straight line. We can admit that in this case the curvature is zero along the line. For a portion of a circle, the curvature is defined to be inversely proportional to the radius of the circle:
	
	\begin{equation}
	\kappa = \frac{1}{R}
	\end{equation}
	
		\begin{figure}
			\centering
			\includegraphics[width=0.5\textwidth]{Drawings/Osculating.pdf}
			\caption{The notion of an osculating circle (best local approximation) defines the curvature as the inverse of the radius of the circle.\label{fig:oscul}}
		\end{figure}
	
	More precisely, for any curve, we can locally approximate a sufficiently regular curve (${\cal C}^2$ is enough) at a point by a circle that best approximates it locally (see Fig.~\ref{fig:oscul}. This circle is tangent to $C$ and is called an {\em osculating circle}. The radius of this circle defines the curvature.
	

	
	Another way to define the curvature is to consider a point moving at a constant speed along the curve $C$. The variation of the tangent vector along the curve defines the curvature. This is equivalent to specifying the acceleration of the point.
	
	
	\begin{equation}
	\kappa = \frac{d \mathbf{T}}{ds},
	\end{equation}
	
	where $s$ is a parametrisation of the curve. Both definition of the curvature
	are in fact equivalent (see Fig.~\ref{fig:theta}). 
	
	\begin{figure}
		\centering
		\includegraphics[width=0.3\textwidth]{Drawings/theta.pdf}
		\caption{We can write $\sin d\theta \approx d\theta = \frac{ds}{R}$. As ds tends to zero, we have $R = \frac{d\theta}{ds} = \frac{d \mathbf{T}}{ds}$.\label{fig:theta}}
	\end{figure}
	
	
	\section*{Parametrisation}
	
	Let $\gamma(t)$ be a parametrisation of the curve $C$, i.e.
	
	\begin{equation}
	\gamma(t) = (x(t),y(t))
	\end{equation}
	
	This defines the position of a point on the curve over time. We assume an injective parametrisation, i.e. such that
	the speed $\gamma'(t)$ is never zero. This means 
	
	\begin{equation}
	\forall t, \|\gamma'(t)\|^2 = x'(t)^2 + y'(t)^2 > 0 
	\end{equation}
	
	In this case, we can re-paramametrise the curve with curvilinear abcissa $s$ in such a way that the speed is constant and equal to one.
	
	\begin{equation}
	\forall s, \gamma'(s)^2 = x'(s)^2 + y'(s)^2 = 1
	\end{equation} 
	
	In this parametrisation, $\gamma'$ is the unit tangent velocity vector $\mathbf{T}$. If $\mathbf{N}$ is the unit normal vector to the curve, we have
	
	\begin{equation}
	\mathbf{T}'(s) = \kappa(s)\mathbf{N}(s)
	\end{equation}
	
	We note that instead of deriving the unit tangent vector, we can also consider deriving the unit normal vector. This is because $\mathbf{N}$ is $\mathbf{T}$ rotated by $\frac{\pi}{2}$, i.e. $\mathbf{N}(x,y) = (-y'(s),x'(s))$. This yields
	
	\begin{equation}
	\mathbf{N}'(s) = \kappa(s)\mathbf{T}(s)
	\end{equation}
	
	We will make use of that fact in the next section.
	
	\section*{Level sets}
	
	In imaging it can be difficult to represent a parametric curve because of discretization effects. It is common to
	represent it by a {\em level set} (see Fig.~\ref{fig:level_set}).
	
	\begin{figure}
		\centering
		\includegraphics[width=0.5\textwidth]{Images/Level_set_method.jpg}
		\caption{Representing a curve by a level set.\label{fig:level_set}}
	\end{figure}
	
	Let $\phi(x,y)$ be a ${\cal C}^2$ function in a domain $\Omega$. We define the curve $\Gamma$ as the zero-level-set of this function
	
	\begin{equation}
	\Gamma = \{(x,y), \phi(x,y) = 0\}
	\end{equation}
	
	$\Gamma$ is a set and no longer a parametrized curve, however we can manipulate it by working on the underlying $\phi$ function. This is the main idea behind the level-set method~\cite{Sethian-level-sets-1999}.
	

	
	\section*{Level sets and curvature}
	
	Curvature is easy to define in the level set case. For any point $(x,y)$ in $\Omega$, $\nabla \phi (x,y)$ is the gradient at $(x,y)$. If we consider the level-set at $(x,y,\phi(x,y))$, i.e. the curve that passes through $(x,y)$ at level $\phi(x,y)$, 
	then $\nabla \phi(x,y)$ is the normal vector to this curve at $(x,y)$. The unit normal is given by
	
	\begin{equation}
	\mathbf{n}(x,y) = \frac{\nabla \phi}{|\nabla \phi|}(x,y)
	\end{equation}
	
	The curvature is given by the derivative of this expression. However this is a multidimensional derivative. Since $\nabla \phi$ is a vector, we must use the divergence operator:
	
	\begin{equation}
	\kappa = \nabla . \frac{\nabla \phi}{|\nabla \phi|}
	\end{equation}
	
	This is in particular true for the computation of the curvature of $\Gamma$. 
	
		\begin{figure}
			\centering
			\includegraphics[width=0.5\textwidth]{Drawings/Distance.pdf}
			\caption{The faster the normal evolves along a curve, the higher the curvature.}
		\end{figure}
		
	\section{Application to our problem}
	
We want to define how to sample a segment $p_1p_2$ so that checking at each sampling point if it is located outside the perfusion territory, we can conclude the segment belongs inside the territory or not. The number of checking ($n + 1$), shall be optimized in order to avoid too many tests (minimize computation time) but also to guarantee the result with a tolerance reasonable enough (maximize test accuracy).

	\subsection{First approach} \label{firstaproach}

We can estimate $n$, the number of tests along the segment, from:
\begin{equation}
n \propto \frac{|p_1 - p_0|}{R}
\end{equation}
$R$ is an approximation of the local curvature along the segment by estimating the divergence at each point $p_1$ and $p_2$, called $R_1$ and $R_2$ respectively :
\begin{equation}
R = max(|R_1|, |R_2|)
\end{equation} 
The figure \ref{example} illustrates the relationship between $D = |p_1 - p_0|$, $R_1$, $R_2$ and $n$. 
\begin{figure}[h!]
\centering
\includegraphics[width=0.5\textwidth]{Drawings/CurvatureTestExample.png}
\caption{When $D$ gets bigger relatively to $max(|R_1, R_2|)$, the value of $n$ is also higher to detect if the segment crosses the perfusion territory.}
\label{example}
\end{figure}

The divergence of a a continuously differentiable vector field $\omega$ is equal to the scalar value function:
\begin{equation}
div (\omega) = (\frac{\partial}{\partial x}, \frac{\partial}{\partial y}) \cdot (\omega_x, \omega_y) 
\end{equation}
\begin{equation}
div (\omega) = \left( \omega_x(x, y) - \omega_x(x-1, y) \right) + \left( \omega_y(x, y) - \omega_y(x, y - 1) \right)
\end{equation}
with
\begin{equation}
\omega_x = \nabla_x \omega = \omega (x + 1, y) - \omega (x, y)
\end{equation}
and
\begin{equation}
\omega_y = \nabla_y \omega = \omega (x, y + 1) - \omega (x, y)
\end{equation}	

\subsection{Second approach}

We are in the case of measuring the curvature along a segment, so we could use the segment information within an iterative process.
\subsubsection{Interpolating the point along the segment line that crosses the concavity} \label{subsec}
We calculate the distances $\lambda_i$ that solves:
\begin{equation}
\omega (p_1) + \lambda_1 \frac{<\nabla \omega(p_1), p_1p_2>}{||p_1p_2||} = 0 
\end{equation}
\begin{equation}
\omega (p_2) + \lambda_2\frac{<\nabla \omega(p_2), p_2p_1>}{||p_1p_2||} = 0
\end{equation}

and then select:
\begin{equation}
\lambda = min(\lambda_1, \lambda_2)
\end{equation}
to obtain :
\begin{equation}
n = \Bigl\lceil \frac{1}{\lambda} \Bigr\rceil
\end{equation}
If $lambda > 1$ it means the line $p_1p_2$ crosses the concavity outside of the segment $p_1p_2$. We would approximate that there is actually no need of computing test along the segment. But we have to keep in mind that this interpretation comes only from a local approximation.

\begin{figure}[h!]
			\label{spe issue}
			\centering
			\includegraphics[width=0.25\textwidth]{Drawings/CurvatureTestExample1.png}
			\caption{Specific situation where the local gradient doesn't help detecting the concavity.}
\end{figure}
Also, this method would fail for any case where the dot product $<\nabla \omega(p_1), p_1p_2> \simeq 0$, and in some specific situations such as the figure \ref{spe issue}. Hence we need to define a global boundary:
\begin{equation}
n \geq \frac{||p_1p_2||}{R_{max}} 
\end{equation}
with $R_{max}$ the maximal curvature radius of both inner and outer surfaces.

Note: because of the segmentation, we might actually obtain $R_{max}$ close to zero, hence it is necessary to consider a tolerance $s$ so that 
\begin{equation}
R_{max}^* = R_{max} + s
\end{equation}

\begin{figure}[h!]
			\centering
			\includegraphics[width=0.25\textwidth]{Drawings/CurvatureTolerance.png}
			\caption{The maximally inscribed radius and tolerance s define a semi-cord $c$.}
\end{figure}

The semi-cord $c$ defined by $R_{max}^*$ and $s$ is calculated as:
\begin{equation}
c = \sqrt{(R_{max}^*-s)^2 - R_{max}^{*2}}
\end{equation} 
That can be simplified as:
\begin{equation}
c = \sqrt{R_{max}^2 - (R_{max} + s)^2}
\end{equation}
The global boundary follows this tolerance:
\begin{equation}
n \geq \frac{||p_1p_2||}{c}
\end{equation}

We take the biggest $n$ between maximal curvature and gradient method. This provides a robust sampling definition considering both local and global informations, see figure \ref{test sampling}.
\begin{figure}[h!]
			\label{test sampling}
			\centering
			\includegraphics[width=0.35\textwidth]{Drawings/CurvatureTestExample2.png}
			\caption{Specific situation where the local gradient doesn't help detecting the concavity.}
\end{figure}

\subsubsection{Projecting Newton's method gradient result on the segment}

%You actually don't test if the line defined by the segment $p_1p_2$ crosses a concavity, which actually might not happen!

If we want to find the first point along the gradient direction, starting from $p_1$, that reaches the border of the perfusion territory we look for $gamma_1$ that solves:
\begin{equation}
\omega( p_1 + \gamma_1 \nabla w(p_1)) = 0
\end{equation}
This can also be written as:
\begin{equation}
\omega(p_1) + \gamma_1 ||\nabla w(p_1)|| = 0
\end{equation}
so that :
\begin{equation}
\gamma_1 = - \frac{\omega(p_1)}{||\nabla w(p_1)||} 
\end{equation}

If $|\gamma_1|$ is small, $p_1$ is close to a concavity. 
Then we can use its projection on the segment $p_1p_2$ to determine if the segment is how fast the segment is going toward the concavity.
\begin{equation}
 d_{proj_1} = \gamma_1<\nabla \omega(p_1), p_1p_2>
\end{equation}
Similarly for the $p_2$ segment end, it would be calculated  as:
\begin{equation}
\gamma_2 = - \frac{\omega(p_2)}{||\nabla w(p_2)||} 
\end{equation}
and then
\begin{equation}
 d_{proj_2} = \gamma_2<\nabla \omega(p_2), p_2p_1>
\end{equation}
If any of the $d_{proj_i}$ is negative we know that the segment is locally going away from the concavity.

We select the smallest of the two sampling distance:
\begin{equation}
d_{proj} = min(d_{proj_1}, d_{proj_2})
\end{equation}

The distance $|d_{proj}|$ is efficient to sample the segment, so $n$ is defined as:
\begin{equation}
n = \Bigl\lceil\frac{||p_1p_2||}{|d_{proj|}}\Bigr\rceil
\end{equation}
%\begin{equation}
%n = \Bigl\lceil\frac{||p_1p_2||}{|\gamma < \nabla \omega(p_1), p_1p_2>|}\Bigl\rceil 
%\end{equation}

We need to use the same boundaries than defined in \ref{subsec}.\\


%\begin{figure}[h!]
%\centering
%\includegraphics[width=0.35\textwidth]{Drawings/ProjectionTest.png}
%\caption{The gradient of potential at $P_1$ is projected along the segment $p_1p_2$. The sampling distance is calculated as half way.}
%\label{projectiontest}
%\end{figure}


These two methods are expected to be more accurate than the previous one \ref{firstaproach}, because they consider the potential along the segment (not only at the tips), but also both local and global curvatures.
It will be interesting to compare these two last method.


\bibliography{notes_ht.bib}
\bibliographystyle{plain}
	
\end{document}